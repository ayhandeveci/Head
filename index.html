<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ã‡arkÄ±felek â€” ToplantÄ± Bahaneleri</title>
<style>
  :root{--bg:#0f1220; --panel:#151a2d; --ink:#e9edf8; --muted:#9aa4c7;}
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100svh; display:flex; align-items:center; justify-content:center;
    font:500 16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    color:var(--ink); background:radial-gradient(1200px 1200px at 50% -200px,#1a2040 0%, var(--bg) 55%, #0b0e1a 100%);
  }
  .wrap{width:min(94vw,960px); display:grid; gap:16px; justify-items:center; text-align:center}
  .card{width:100%; padding:16px 18px; background:linear-gradient(180deg,#1b2141 0%, var(--panel) 100%);
        border:1px solid #293058; border-radius:16px; box-shadow:0 6px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04)}
  h1{font-size:22px; margin:0 0 2px; letter-spacing:.2px}
  p.sub{margin:0; color:var(--muted); font-size:14px}
  .stage{position:relative; width:min(86vw,560px); aspect-ratio:1/1}
  canvas{width:100%; height:100%; display:block; filter:drop-shadow(0 12px 22px rgba(0,0,0,.45))}
  .pointer{position:absolute; inset:0; pointer-events:none; display:grid; place-items:start center}
  .pointer svg{margin-top:-6px; filter:drop-shadow(0 6px 12px rgba(0,0,0,.35))}
  .controls{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center}
  button{
    appearance:none; border:1px solid #2c3a6a; background:linear-gradient(180deg,#27449a,#1e3475);
    color:#fff; padding:11px 14px; border-radius:12px; font-weight:700; letter-spacing:.2px; cursor:pointer;
    transition:transform .06s ease, filter .2s ease, opacity .2s ease;
  }
  button.secondary{background:linear-gradient(180deg,#313a66,#263156)}
  button:hover{filter:brightness(1.06)}
  button:active{transform:translateY(1px)}
  button[disabled]{opacity:.55; cursor:not-allowed; filter:grayscale(.2) brightness(.9)}
  .result{font-size:18px; font-weight:800; letter-spacing:.2px; padding:10px 14px; border-radius:12px; display:inline-block;
          background:linear-gradient(180deg,#18224a,#121a35); border:1px solid #2a3566; color:#dfe7ff}
  .hint{color:var(--muted); font-size:13px; margin-top:4px}
  .editor{width:100%; display:grid; gap:10px; text-align:left}
  details{width:100%}
  details>summary{cursor:pointer; padding:10px 12px; background:#121936; border:1px solid #253160; border-radius:10px; color:#dfe7ff}
  .panel{padding:12px; background:#0f1630; border:1px solid #27336a; border-radius:10px; margin-top:8px}
  textarea{width:100%; min-height:120px; resize:vertical; padding:10px; border-radius:10px; border:1px solid #2b3a6b;
           background:#0c142c; color:#e9edf8; font:500 14px/1.35 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .tag{font-size:12px; color:#9fb3ff; border:1px solid #2a3b76; padding:4px 8px; border-radius:999px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Ã‡arkÄ±felek â€” ToplantÄ± Bahaneleri</h1>
      <p class="sub">Sade tasarÄ±m, akÄ±llÄ± metin yerleÅŸimi, deÄŸiÅŸken hÄ±z ve â€œÃ§ap Ã§apâ€ ses ğŸ˜Š</p>
    </div>

    <div class="stage">
      <canvas id="wheel" width="1200" height="1200" aria-label="Ã‡arkÄ±felek"></canvas>
      <div class="pointer" aria-hidden="true">
        <svg width="42" height="42" viewBox="0 0 42 42">
          <path d="M21 4 L32 22 L10 22 Z" fill="url(#g)"/>
          <defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#f9d37d"/><stop offset="1" stop-color="#e4a93c"/></linearGradient></defs>
          <circle cx="21" cy="25" r="5.5" fill="#0e1430" stroke="#e4a93c" stroke-width="2"/>
        </svg>
      </div>
    </div>

    <div class="controls">
      <button id="spinBtn">ğŸ¯ Ã‡evir</button>
      <button id="reshuffleBtn" class="secondary" title="Dilimleri karÄ±ÅŸtÄ±r">ğŸ”€ KarÄ±ÅŸtÄ±r</button>
      <button id="copyBtn" class="secondary" title="Sonucu kopyala" disabled>ğŸ“‹ Sonucu Kopyala</button>
      <button id="soundBtn" class="secondary" title="TarayÄ±cÄ± sesi kilitliyse aÃ§mak iÃ§in" style="display:none">ğŸ”Š Sesi AÃ§</button>
    </div>

    <div id="result" class="result" style="display:none;"></div>
    <div class="hint"><span id="count" class="tag">Dilim sayÄ±sÄ±: â€“</span></div>

    <!-- KullanÄ±cÄ± dÃ¼zenleme -->
    <details>
      <summary>âœï¸ SeÃ§enekleri DÃ¼zenle / Ä°Ã§eri Aktar</summary>
      <div class="panel editor">
        <div class="row">
          <button id="loadDefaultsBtn">ğŸ“¦ VarsayÄ±lanlarÄ± YÃ¼kle</button>
          <button id="exportBtn" title="Mevcut listeyi panoya kopyala">â¬‡ï¸ DÄ±ÅŸa Aktar</button>
          <span class="tag">Metinleri satÄ±r satÄ±r gir veya virgÃ¼llÃ¼/JSON liste yapÄ±ÅŸtÄ±r</span>
        </div>
        <textarea id="textArea" placeholder="Her satÄ±r bir seÃ§enek olacak..."></textarea>
        <div class="row">
          <button id="applyBtn">âœ… Uygula (Metinden Kur)</button>
          <button id="clearBtn">ğŸ§¹ Temizle</button>
          <input id="oneInput" placeholder="Tek bir seÃ§enek ekle" style="flex:1">
          <button id="addOneBtn">â• Ekle</button>
        </div>
      </div>
    </details>

    <div class="hint">Ses Ã§Ä±kmÄ±yorsa bir kez â€œSesi AÃ§â€a dokunâ€”iOS/Safari ilk etkileÅŸimde izin istiyor olabilir.</div>
  </div>

<script>
/* ======================= VARSAYILANLAR (Teams havasÄ±) ======================= */
const DEFAULTS = [
  "Sesim geliyor mu? Bir daha deneyeyim",
  "Ekran dondu, 1 dk verin",
  "Teams bende Ã§Ã¶ktÃ¼, geri geliyorum",
  "Link eskiymiÅŸ galiba, yeniden katÄ±layÄ±m",
  "VPN yÃ¼zÃ¼nden gecikme var",
  "Bunu chatâ€™e yazayÄ±m, detaylÄ± dÃ¶nÃ¼ÅŸ yapayÄ±m",
  "Not aldÄ±m, parking lotâ€™a koyuyorum",
  "Ã–nce kÃ¼Ã§Ã¼k bir POC yapalÄ±m",
  "Roadmapâ€™e alÄ±p Ã¶nceliklendirelim",
  "YÃ¶netim onayÄ± lazÄ±m",
  "Veri tarafÄ±nÄ± bekliyoruz",
  "Aksiyon aÃ§Ä±yorum, sahibi kim olsun?",
  "Bu sprintâ€™e yetiÅŸmez",
  "Riskini deÄŸerlendirelim",
  "SLA kapsamÄ± dÄ±ÅŸÄ±nda kalÄ±yor",
  "ToplantÄ±dan sonra yazÄ±lÄ± dÃ¶nerim",
  "Mikrofon bende sÄ±kÄ±ntÄ±lÄ±, dinlemedeyim",
  "Kamera kapalÄ± olsun, baÄŸlantÄ±m zayÄ±f",
  "KayÄ±t alÄ±nÄ±yor mu? Linkini paylaÅŸalÄ±m",
  "Bir sonraki toplantÄ±da Ã¼stÃ¼nden geÃ§elim"
];
const LS_KEY = "carki_options_v4";
let OPTIONS = [];

/* ======================= KANVAS ======================= */
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const DPR = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
let sizeCSS;
function fitCanvas(){
  const holder = document.querySelector(".stage");
  const rect = holder.getBoundingClientRect();
  sizeCSS = Math.floor(Math.min(rect.width, rect.height));
  canvas.style.width = sizeCSS + "px";
  canvas.style.height = sizeCSS + "px";
  canvas.width = Math.floor(sizeCSS * DPR);
  canvas.height = Math.floor(sizeCSS * DPR);
}
fitCanvas();
window.addEventListener("resize", ()=>{ fitCanvas(); drawWheel(); });

/* ======================= SES (WebAudio, iOS dostu) ======================= */
let audioCtx = null;
let audioUnlocked = false;
function ensureAudio(){
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)({latencyHint:"interactive"});
  if (audioCtx.state === "suspended") audioCtx.resume();
}
function unlockAudio(){
  ensureAudio();
  audioUnlocked = true;
  document.getElementById("soundBtn").style.display = "none";
}
// iOS/Safari iÃ§in: ilk dokunuÅŸta sesi aÃ§mayÄ± dene
["pointerdown","touchend","click"].forEach(ev=>{
  document.addEventListener(ev, ()=>{ if(!audioUnlocked){ unlockAudio(); } }, {once:true, passive:true});
});
function tickSound(speedNorm=0.5){
  ensureAudio();
  if (!audioCtx) return;
  const t = audioCtx.currentTime;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  const freq = 450 + speedNorm*300;        // hÄ±zlandÄ±kÃ§a tizleÅŸsin
  const dur = 0.03 + 0.02*speedNorm;       // hÄ±zlÄ±yken daha kÄ±sa â€œÃ§apâ€
  const vol = 0.10 + speedNorm*0.12;

  osc.type = "square";
  osc.frequency.setValueAtTime(freq, t);
  gain.gain.setValueAtTime(vol, t);
  gain.gain.exponentialRampToValueAtTime(0.0001, t + dur);

  osc.connect(gain).connect(audioCtx.destination);
  osc.start(t);
  osc.stop(t + dur);
}

/* ======================= DÃ–NDÃœRME FÄ°ZÄ°ÄÄ° ======================= */
let rotation = 0;      // rad
let spinning = false;
let angularVel = 0;    // rad/s
let lastFrameTime = 0;

function drawWheel(highlightIndex=null){
  const W = canvas.width, H = canvas.height;
  const r = Math.min(W,H)/2 * 0.96;
  const cx = W/2, cy = H/2;
  const inner = r * 0.18;
  const N = OPTIONS.length || 1;
  const dÎ¸ = (Math.PI*2)/N;

  ctx.clearRect(0,0,W,H);

  // halo
  ctx.save(); ctx.translate(cx,cy); ctx.filter="blur(18px)";
  ctx.beginPath(); ctx.arc(0,0,r*0.98,0,Math.PI*2); ctx.fillStyle="#0a0f27"; ctx.fill();
  ctx.restore(); ctx.filter="none";

  ctx.save(); ctx.translate(cx,cy); ctx.rotate(rotation);

  for(let i=0;i<N;i++){
    const a0=i*dÎ¸, a1=a0+dÎ¸;
    ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,r,a0,a1,false); ctx.closePath();
    if (highlightIndex===i){ ctx.fillStyle="rgba(255,255,255,.12)"; ctx.fill(); }
    // sade, ama canlÄ± bir gÃ¶kkuÅŸaÄŸÄ± paleti
    ctx.fillStyle = `hsl(${Math.round((i*360)/N)}, ${N>10?72:78}%, ${N>10?56:60}%)`;
    ctx.fill();
    ctx.lineWidth=r*0.006; ctx.strokeStyle="rgba(0,0,0,.25)"; ctx.stroke();

    // METÄ°N: akÄ±llÄ± sÄ±ÄŸdÄ±rma (max 3 satÄ±r, auto font)
    ctx.save();
    ctx.rotate(a0 + dÎ¸/2);
    ctx.translate(r*0.64, 0);     // metin yarÄ±Ã§apÄ±
    ctx.rotate(Math.PI/2);
    ctx.textAlign="center"; ctx.textBaseline="middle";
    drawSmartLabel(OPTIONS[i] || "", r, dÎ¸);
    ctx.restore();
  }

  // merkez
  ctx.beginPath(); ctx.arc(0,0,inner,0,Math.PI*2);
  const grad = ctx.createRadialGradient(0,0,inner*0.2, 0,0,inner);
  grad.addColorStop(0,"#0e1430"); grad.addColorStop(1,"#101736");
  ctx.fillStyle=grad; ctx.fill();
  ctx.lineWidth=r*0.012; ctx.strokeStyle="#24305e"; ctx.stroke();
  ctx.fillStyle="#93a5ff"; ctx.font=`600 ${Math.floor(inner*0.38)}px system-ui,-apple-system`;
  ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.fillText("Ã‡ARK",0,0);
  ctx.restore();

  // dÄ±ÅŸ Ã§erÃ§eve
  ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2);
  ctx.lineWidth=r*0.015; ctx.strokeStyle="#2f3a70"; ctx.stroke();

  updateUIState();
}

// AkÄ±llÄ± label: 3 satÄ±ra kadar kÄ±r, fontu kÃ¼Ã§Ã¼lterek sÄ±ÄŸdÄ±r
function drawSmartLabel(text, r, dÎ¸){
  const maxLines = 3;
  const textRadius = r*0.64;
  const arcWidth = dÎ¸ * textRadius * 0.92;   // izinli yay uzunluÄŸu
  let fontPx = Math.floor(r*0.095);
  let lines = [];

  // dene-kÃ¼Ã§Ã¼lt: fontu azalt, 3 satÄ±ra sÄ±ÄŸdÄ±r
  for (; fontPx >= Math.floor(r*0.05); fontPx--){
    ctx.font = `${fontPx}px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial`;
    lines = wrapLines(text, arcWidth, maxLines);
    if (lines.ok) break;
  }

  ctx.fillStyle="#0e1430";
  const lh = fontPx*1.08;
  const startY = -((lines.arr.length-1)*lh)/2;
  lines.arr.forEach((ln, i)=> ctx.fillText(ln, 0, startY + i*lh));
}

function wrapLines(text, maxW, maxL){
  const words = String(text).split(/\s+/).filter(Boolean);
  const out=[]; let line="";
  for (const w of words){
    const test = line ? line + " " + w : w;
    if (ctx.measureText(test).width <= maxW || !line){
      line = test;
    } else {
      out.push(line); line = w;
      if (out.length === maxL-1){
        // son satÄ±r: sÄ±ÄŸmÄ±yorsa kÄ±rp
        let rest = line + " " + words.slice(words.indexOf(w)+1).join(" ");
        while (ctx.measureText(rest + " â€¦").width > maxW && rest.length>0){
          rest = rest.slice(0,-1);
        }
        out.push(rest.trim() + (rest ? " â€¦" : ""));
        return {arr:out, ok:true};
      }
    }
  }
  if (line) out.push(line);
  return {arr:out, ok:true};
}

const ri=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

function spinToRandom(){
  if (spinning || OPTIONS.length<2) return;
  spinning=true; setResult("");
  ensureAudio(); // iOSâ€™ta ses iÃ§in

  const N=OPTIONS.length, dÎ¸=(Math.PI*2)/N;
  const targetIndex=ri(0,N-1);
  const targetAngle=targetIndex*dÎ¸ + dÎ¸/2;

  const base=((rotation%(Math.PI*2))+Math.PI*2)%(Math.PI*2);
  let delta=(-Math.PI/2 - base - targetAngle);
  delta=((delta%(Math.PI*2))+Math.PI*2)%(Math.PI*2);

  // deÄŸiÅŸken hÄ±z: tur sayÄ±sÄ±, sÃ¼re, easing her seferinde farklÄ±
  const extraTurns=ri(5,9);
  const finalRotation = rotation + delta + extraTurns*(Math.PI*2);
  const duration = ri(3600,5800); // ms
  const easeType = Math.random()<0.5 ? "quint" : "expo";
  const t0 = performance.now(); const startRot=rotation;

  // tick algÄ±sÄ±
  let lastTickIndex = -1;

  function easeOutQuint(t){ return 1 - Math.pow(1-t, 5); }
  function easeOutExpo(t){ return t===1 ? 1 : 1 - Math.pow(2, -10*t); }
  const ease = (t)=> easeType==="quint" ? easeOutQuint(t) : easeOutExpo(t);

  function frame(now){
    const dt = (now - (lastFrameTime || now)) / 1000;
    lastFrameTime = now;

    const p=Math.min(1,(now-t0)/duration), e=ease(p);
    const newRot = startRot + (finalRotation - startRot)*e;
    angularVel = Math.abs(newRot - rotation) / Math.max(dt, 1/240); // rad/s
    rotation = newRot;
    drawWheel();

    // hÄ±z (0..1) normalize
    const speedNorm = Math.max(0, Math.min(1, angularVel / 20));

    // imleÃ§ -Ï€/2; altÄ±nda kalan dilim indeks deÄŸiÅŸince â€œÃ§apâ€
    const pointerAngle = (-Math.PI/2 - rotation);
    const idx = ((Math.floor(((pointerAngle % (Math.PI*2) + Math.PI*2) % (Math.PI*2)) / dÎ¸)) + N) % N;

    if (idx !== lastTickIndex){
      tickSound(speedNorm);
      lastTickIndex = idx;
    }

    if (p < 1) {
      requestAnimationFrame(frame);
    } else {
      rotation = finalRotation % (Math.PI*2);
      const idxFinal = targetIndex;
      drawWheel(idxFinal);
      setResult(OPTIONS[idxFinal]);
      spinning=false;
    }
  }
  requestAnimationFrame(frame);
}

/* ======================= LÄ°STE / UI ======================= */
const $ = sel => document.querySelector(sel);
const $spin=$("#spinBtn"), $shuffle=$("#reshuffleBtn");
const $ta=$("#textArea"), $count=$("#count"), $one=$("#oneInput");
const $copy=$("#copyBtn"), $sound=$("#soundBtn");

function updateUIState(){
  $count.textContent = "Dilim sayÄ±sÄ±: " + OPTIONS.length;
  $spin.disabled = OPTIONS.length<2;
  $shuffle.disabled = OPTIONS.length<2 || spinning;
  $copy.disabled = !$("#result").textContent;
  // ses kilitli ise â€œSesi AÃ§â€ gÃ¶ster
  $sound.style.display = (audioCtx && audioCtx.state==="running") ? "none" : "inline-block";
}
function saveLocal(){ try{ localStorage.setItem(LS_KEY, JSON.stringify(OPTIONS)); }catch{} }
function loadLocal(){
  try{
    const raw=localStorage.getItem(LS_KEY);
    if(raw){ const arr = JSON.parse(raw); if(Array.isArray(arr) && arr.length){ OPTIONS=[...uniqueClean(arr)]; return true; }
  }}catch{}
  return false;
}
function uniqueClean(arr){ return sanitizeTokens(arr); }

// GeliÅŸmiÅŸ yapÄ±ÅŸtÄ±rma ayrÄ±ÅŸtÄ±rÄ±cÄ±sÄ±
function parseOptions(rawText){
  if (!rawText) return [];
  const t = rawText.trim();
  if (t.startsWith("[") && t.endsWith("]")) {
    try { const arr = JSON.parse(t); if (Array.isArray(arr)) return sanitizeTokens(arr); } catch {}
  }
  const hasNewlines = /\r?\n/.test(t);
  let tokens = hasNewlines ? t.split(/\r?\n/) : t.split(/\s*[;,|]\s*/);
  return sanitizeTokens(tokens);
}
function sanitizeTokens(tokens){
  const cleaned = tokens
    .map(s => String(s)
      .replace(/^\s*(?:\d{1,4}[\)\.\-:]\s*|[-*â€¢â€“]\s*)/, "")
      .replace(/^["'â€œâ€â€˜â€™]+|["'â€œâ€â€˜â€™]+$/g, "")
      .replace(/[.,;:ã€ã€‚Ø›ØŒÂ·]$/u, "")
      .trim()
    )
    .filter(Boolean);
  const seen = new Set(), out=[];
  for (let item of cleaned){
    if (item.length > 140) item = item.slice(0, 140).trim();
    if (!seen.has(item)){ seen.add(item); out.push(item); }
    if (out.length >= 200) break;
  }
  return out;
}

function loadDefaults(){ OPTIONS=[...DEFAULTS]; saveLocal(); rotation=0; setResult(""); drawWheel(); fillTextarea(); }
function fillTextarea(){ $ta.value = OPTIONS.join("\n"); }
function applyFromTextarea(){
  const cleaned = parseOptions($ta.value);
  OPTIONS = cleaned.length ? cleaned : [];
  saveLocal(); rotation=0; setResult(""); drawWheel();
}
function addOne(){
  const v = ($one.value||"").trim(); if(!v) return;
  if(!OPTIONS.includes(v)) OPTIONS.push(v);
  $one.value=""; saveLocal(); fillTextarea(); drawWheel();
}
function exportList(){
  const txt = OPTIONS.join("\n");
  navigator.clipboard?.writeText(txt).then(()=>{ alert("Mevcut liste panoya kopyalandÄ±."); })
  .catch(()=>{ prompt("Kopyalamak iÃ§in Ctrl/Cmd+C:", txt); });
}
function clearList(){ OPTIONS=[]; saveLocal(); fillTextarea(); drawWheel(); }
function setResult(txt){
  const el=$("#result");
  if(!txt){ el.style.display="none"; el.textContent=""; updateUIState(); return; }
  el.textContent="SeÃ§ilen: "+txt; el.style.display="inline-block"; updateUIState();
}

/* ======================= OLAYLAR ======================= */
$("#loadDefaultsBtn").addEventListener("click", loadDefaults);
$("#applyBtn").addEventListener("click", applyFromTextarea);
$("#clearBtn").addEventListener("click", clearList);
$("#addOneBtn").addEventListener("click", addOne);
$("#exportBtn").addEventListener("click", exportList);
$spin.addEventListener("click", spinToRandom);
$shuffle.addEventListener("click", ()=>{
  if(spinning || OPTIONS.length<2) return;
  for(let i=OPTIONS.length-1;i>0;i--){ const j=ri(0,i); [OPTIONS[i],OPTIONS[j]]=[OPTIONS[j],OPTIONS[i]]; }
  rotation=0; setResult(""); saveLocal(); fillTextarea(); drawWheel();
});
$copy.addEventListener("click", ()=>{
  const text = $("#result").textContent.replace(/^SeÃ§ilen:\s*/,"");
  if(!text) return;
  navigator.clipboard?.writeText(text).then(()=>{
    const old = $copy.textContent;
    $copy.textContent="âœ… KopyalandÄ±";
    setTimeout(()=>{ $copy.textContent=old; }, 1200);
  });
});
$sound.addEventListener("click", unlockAudio);

/* ======================= BAÅLAT ======================= */
(function init(){
  const ok = loadLocal();
  if(!ok) OPTIONS=[...DEFAULTS];
  fillTextarea();
  drawWheel();
})();
</script>
</body>
</html>